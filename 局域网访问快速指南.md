# 🚀 局域网访问快速指南

## ✅ 已完成的配置

所有配置已为你设置好，支持局域网访问！

---

## 📋 3步快速启动

### 第1步：获取本机IP地址

#### Windows
```cmd
ipconfig
```
找到 `IPv4 地址`，例如：**192.168.1.100**

#### Linux/Mac  
```bash
ifconfig
```
找到局域网IP，例如：**192.168.1.100**

---

### 第2步：启动服务

#### 启动后端
```bash
cd /你存放代码的路径/webapp/backend
mvn spring-boot:run
```

#### 启动前端（新终端）
```bash
cd /你存放代码的路径/webapp/frontend
npm run dev
```

**前端启动成功后会显示**：
```
➜  Local:   http://localhost:5173/
➜  Network: http://192.168.1.100:5173/  ← 这就是局域网地址！
```

---

### 第3步：访问

#### 在部署机器上
```
http://localhost:5173
```

#### 在局域网其他机器上
```
http://192.168.1.100:5173
```
**（替换为你的实际IP）**

---

## 🧪 验证配置

### 自动检查工具

#### Windows
双击运行 `检查网络配置.bat`

#### Linux/Mac
```bash
chmod +x 检查网络配置.sh
./检查网络配置.sh
```

### 手动验证

#### 1. 检查后端监听
```bash
# Windows
netstat -ano | findstr :8080

# Linux/Mac
lsof -i :8080
```
应该看到 `0.0.0.0:8080` 或 `*:8080`

#### 2. 检查前端监听
```bash
# Windows
netstat -ano | findstr :5173

# Linux/Mac
lsof -i :5173
```
应该看到 `0.0.0.0:5173` 或 `*:5173`

#### 3. 测试后端API
```bash
# 在其他机器执行
curl http://192.168.1.100:8080/api/stats
```
应该返回JSON数据

#### 4. 测试前端
在其他机器浏览器打开：`http://192.168.1.100:5173`

---

## 🔧 关键配置说明

### 后端配置
**文件**: `backend/src/main/resources/application.yml`
```yaml
server:
  port: 8080
  address: 0.0.0.0  # ← 监听所有网络接口
```

### 前端配置
**文件**: `frontend/package.json`
```json
"scripts": {
  "dev": "vite --host 0.0.0.0"  # ← 监听所有网络接口
}
```

**文件**: `frontend/src/api/index.js`
- 自动检测后端地址
- localhost访问 → 使用 `http://localhost:8080`
- IP访问 → 使用 `http://你的IP:8080`

---

## 🛡️ 防火墙配置

### Windows

以管理员身份运行CMD：
```cmd
netsh advfirewall firewall add rule name="DeepDrama" dir=in action=allow protocol=TCP localport=8080,5173
```

### Linux (firewalld)
```bash
sudo firewall-cmd --permanent --add-port=8080/tcp
sudo firewall-cmd --permanent --add-port=5173/tcp
sudo firewall-cmd --reload
```

### Linux (ufw)
```bash
sudo ufw allow 8080/tcp
sudo ufw allow 5173/tcp
```

---

## 📱 移动设备访问

1. 确保手机和电脑在同一WiFi
2. 在手机浏览器输入：`http://192.168.1.100:5173`
3. 正常使用

---

## ❌ 常见问题

### 问题1：其他机器无法访问

#### 解决方案A：检查防火墙
运行检查脚本或手动开放端口（见上方）

#### 解决方案B：检查服务监听
确认服务监听 `0.0.0.0` 而不是 `127.0.0.1`

#### 解决方案C：检查网络
确保两台机器在同一局域网，能互相ping通

---

### 问题2：API调用失败

#### 症状
浏览器Console显示：`API Base URL: http://localhost:8080`

#### 解决方案
手动指定后端地址：

```bash
cd /你存放代码的路径/webapp/frontend
echo "VITE_API_BASE_URL=http://192.168.1.100:8080" > .env.local
npm run dev
```

---

### 问题3：前端可访问但显示空白

#### 原因
后端未启动或API地址错误

#### 解决方案
1. 确认后端已启动：`curl http://192.168.1.100:8080/api/stats`
2. 按F12查看Console错误
3. 查看Network标签的请求状态

---

## 📊 成功标志

### ✅ 在其他机器浏览器

**Console（F12 → Console）**：
```
API Base URL: http://192.168.1.100:8080
正在加载统计数据...
统计数据: {totalScripts: 30, ...}
```

**Network（F12 → Network）**：
```
GET http://192.168.1.100:8080/api/stats - 200 OK
GET http://192.168.1.100:8080/api/scripts - 200 OK
```

**页面显示**：
- 数据看板正常显示
- 剧本列表正常加载
- 所有功能正常工作

---

## 🎯 配置文件清单

### 已修改的文件
1. ✅ `backend/src/main/resources/application.yml` - 添加 `address: 0.0.0.0`
2. ✅ `backend/src/main/java/com/deepdrama/config/WebConfig.java` - CORS允许所有来源
3. ✅ `frontend/src/api/index.js` - API地址自动检测
4. ✅ `frontend/package.json` - dev脚本添加 `--host 0.0.0.0`

### 新增的文件
5. ✅ `frontend/.env.development` - 开发环境配置
6. ✅ `frontend/.env.production` - 生产环境配置
7. ✅ `frontend/.env.example` - 配置示例
8. ✅ `检查网络配置.sh` - Linux/Mac检查脚本
9. ✅ `检查网络配置.bat` - Windows检查脚本
10. ✅ `局域网部署指南.md` - 详细部署文档

---

## 📞 总结

### 配置完成
- ✅ 后端监听 0.0.0.0:8080（允许局域网访问）
- ✅ 前端监听 0.0.0.0:5173（允许局域网访问）
- ✅ 前端API地址自动检测
- ✅ CORS允许所有来源
- ✅ 提供检查工具和详细文档

### 使用步骤
1. 获取本机IP（如 192.168.1.100）
2. 启动后端和前端
3. 在其他机器访问 `http://192.168.1.100:5173`

### 验证成功
- ✅ 其他机器能打开前端页面
- ✅ Console显示正确的API Base URL
- ✅ Network显示API请求成功
- ✅ 页面功能正常

---

## 🔗 相关文档

- **详细指南**: `局域网部署指南.md`
- **后端文档**: `JAVA_BACKEND_GUIDE.md`
- **前端文档**: `前端启动指南.md`
- **问题汇总**: `问题解答汇总.md`

现在你的系统已完全支持局域网访问！🎊
