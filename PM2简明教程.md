# ğŸ¯ PM2 ç®€æ˜æ•™ç¨‹

## ä»€ä¹ˆæ˜¯PM2ï¼Ÿ

**PM2** æ˜¯ä¸€ä¸ª Node.js è¿›ç¨‹ç®¡ç†å·¥å…·ï¼Œç±»ä¼¼äº Java ä¸­çš„åå°è¿›ç¨‹ç®¡ç†ã€‚

**ç®€å•ç†è§£**ï¼š
- å°±åƒ Java çš„ `nohup java -jar app.jar &` è®©ç¨‹åºåå°è¿è¡Œ
- PM2 è®©ä½ çš„å‰ç«¯æœåŠ¡åœ¨åå°æŒç»­è¿è¡Œï¼Œå³ä½¿å…³é—­ç»ˆç«¯ä¹Ÿä¸ä¼šåœæ­¢

---

## ğŸš€ æ ¸å¿ƒå‘½ä»¤ï¼ˆåªéœ€è®°ä½è¿™5ä¸ªï¼‰

### 1ï¸âƒ£ å¯åŠ¨æœåŠ¡
```bash
cd /home/user/webapp/frontend
pm2 start ecosystem.config.cjs
```
**ä½œç”¨**ï¼šå¯åŠ¨å‰ç«¯æœåŠ¡ï¼Œè¿è¡Œåœ¨åå°

---

### 2ï¸âƒ£ æŸ¥çœ‹çŠ¶æ€
```bash
pm2 list
```
**æ˜¾ç¤º**ï¼š
```
â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ id â”‚ name                  â”‚ status   â”‚ cpu  â”‚ memory  â”‚
â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1  â”‚ deepdrama-frontend    â”‚ online   â”‚ 0%   â”‚ 45.2mb  â”‚
â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```
- **online** = æ­£åœ¨è¿è¡Œ âœ…
- **stopped** = å·²åœæ­¢ âŒ
- **errored** = è¿è¡Œå‡ºé”™ âš ï¸

---

### 3ï¸âƒ£ æŸ¥çœ‹æ—¥å¿—
```bash
pm2 logs deepdrama-frontend --nostream --lines 20
```
**ä½œç”¨**ï¼šæŸ¥çœ‹æœ€è¿‘20è¡Œæ—¥å¿—ï¼Œè¯Šæ–­é—®é¢˜

**å®æ—¶æŸ¥çœ‹æ—¥å¿—**ï¼ˆç±»ä¼¼ `tail -f`ï¼‰:
```bash
pm2 logs deepdrama-frontend
```
æŒ‰ `Ctrl+C` é€€å‡º

---

### 4ï¸âƒ£ é‡å¯æœåŠ¡
```bash
pm2 restart deepdrama-frontend
```
**ä½•æ—¶ä½¿ç”¨**ï¼š
- ä¿®æ”¹äº†ä»£ç 
- æœåŠ¡å‡ºé”™
- é…ç½®æ›´æ”¹

---

### 5ï¸âƒ£ åœæ­¢æœåŠ¡
```bash
pm2 stop deepdrama-frontend
```
**ä½œç”¨**ï¼šåœæ­¢æœåŠ¡ä½†ä¸åˆ é™¤

**åˆ é™¤æœåŠ¡**ï¼ˆå½»åº•ç§»é™¤ï¼‰:
```bash
pm2 delete deepdrama-frontend
```

---

## ğŸ“‹ å®Œæ•´å¯åŠ¨æµç¨‹

### ç¬¬ä¸€æ¬¡å¯åŠ¨
```bash
cd /home/user/webapp/frontend
pm2 start ecosystem.config.cjs
```

### éªŒè¯è¿è¡Œ
```bash
pm2 list                              # æŸ¥çœ‹çŠ¶æ€
pm2 logs deepdrama-frontend --lines 10  # æŸ¥çœ‹æ—¥å¿—
curl http://localhost:5173            # æµ‹è¯•è®¿é—®
```

### å¦‚æœéœ€è¦é‡å¯
```bash
pm2 restart deepdrama-frontend
```

---

## ğŸ†š PM2 vs æ™®é€šå¯åŠ¨

### ä¸ç”¨PM2ï¼ˆæ™®é€šæ–¹å¼ï¼‰
```bash
npm run dev
```
**ç‰¹ç‚¹**ï¼š
- âŒ å…³é—­ç»ˆç«¯ï¼ŒæœåŠ¡åœæ­¢
- âŒ éœ€è¦ä¸€ç›´å¼€ç€ç»ˆç«¯çª—å£
- âœ… é€‚åˆä¸´æ—¶å¼€å‘æµ‹è¯•

### ä½¿ç”¨PM2
```bash
pm2 start ecosystem.config.cjs
```
**ç‰¹ç‚¹**ï¼š
- âœ… å…³é—­ç»ˆç«¯ï¼ŒæœåŠ¡ç»§ç»­è¿è¡Œ
- âœ… è‡ªåŠ¨é‡å¯ï¼ˆå¦‚æœå´©æºƒï¼‰
- âœ… æ—¥å¿—ç®¡ç†
- âœ… é€‚åˆç”Ÿäº§ç¯å¢ƒæˆ–é•¿æœŸè¿è¡Œ

---

## ğŸ” å¸¸è§åœºæ™¯

### åœºæ™¯1ï¼šå‰ç«¯æœåŠ¡æŒ‚äº†
```bash
pm2 list                    # æŸ¥çœ‹çŠ¶æ€ï¼Œå¦‚æœæ˜¾ç¤º errored
pm2 logs deepdrama-frontend # æŸ¥çœ‹é”™è¯¯æ—¥å¿—
pm2 restart deepdrama-frontend  # é‡å¯æœåŠ¡
```

### åœºæ™¯2ï¼šä¿®æ”¹äº†ä»£ç 
```bash
pm2 restart deepdrama-frontend  # é‡å¯ç”Ÿæ•ˆ
```

### åœºæ™¯3ï¼šæƒ³çœ‹æœåŠ¡è¾“å‡º
```bash
pm2 logs deepdrama-frontend --nostream --lines 50
```

### åœºæ™¯4ï¼šç«¯å£è¢«å ç”¨
```bash
fuser -k 5173/tcp  # æ€æ‰å ç”¨ç«¯å£çš„è¿›ç¨‹
pm2 restart deepdrama-frontend  # é‡å¯å‰ç«¯
```

---

## ğŸ“Š å½“å‰ç³»ç»ŸçŠ¶æ€

### âœ… å‰ç«¯å·²å¯åŠ¨
- **æœåŠ¡å**: `deepdrama-frontend`
- **ç«¯å£**: 5173
- **è®¿é—®**: http://localhost:5173

### æŸ¥çœ‹çŠ¶æ€
```bash
pm2 list
```

### æŸ¥çœ‹æ—¥å¿—
```bash
pm2 logs deepdrama-frontend --nostream
```

---

## âš ï¸ é‡è¦æç¤º

1. **PM2 é…ç½®æ–‡ä»¶**: `ecosystem.config.cjs`
   - å·²é…ç½®å¥½ï¼Œæ— éœ€ä¿®æ”¹
   - æŒ‡å®šäº†å¯åŠ¨å‘½ä»¤ã€ç«¯å£ã€æ—¥å¿—è·¯å¾„

2. **æ—¥å¿—æ–‡ä»¶ä½ç½®**: `frontend/logs/`
   - `out.log`: æ­£å¸¸è¾“å‡º
   - `error.log`: é”™è¯¯æ—¥å¿—

3. **ä¸å½±å“å¼€å‘**:
   - PM2åªæ˜¯ç®¡ç†è¿›ç¨‹
   - ä½ ä»ç„¶å¯ä»¥ä¿®æ”¹ä»£ç ã€è°ƒè¯•
   - Viteä¼šè‡ªåŠ¨çƒ­æ›´æ–°ï¼ˆä¿®æ”¹ä»£ç è‡ªåŠ¨åˆ·æ–°é¡µé¢ï¼‰

---

## ğŸ¯ è®°ä½è¿™ä¸€è¡Œ

**æœ€å¸¸ç”¨çš„å‘½ä»¤**ï¼š
```bash
pm2 list && pm2 logs deepdrama-frontend --nostream --lines 10
```
è¿™ä¸€è¡Œå‘½ä»¤ä¼šæ˜¾ç¤ºæœåŠ¡çŠ¶æ€å’Œæœ€è¿‘æ—¥å¿—ï¼Œ90%çš„æƒ…å†µè¶³å¤Ÿç”¨äº†ã€‚

---

## ğŸ“š è¿›é˜¶å‘½ä»¤ï¼ˆå¯é€‰ï¼‰

```bash
pm2 monit                  # å®æ—¶ç›‘æ§CPUå’Œå†…å­˜
pm2 info deepdrama-frontend  # æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯
pm2 describe deepdrama-frontend  # åŒä¸Š
pm2 save                   # ä¿å­˜å½“å‰è¿›ç¨‹åˆ—è¡¨
pm2 startup                # è®¾ç½®å¼€æœºè‡ªå¯åŠ¨
```

---

## ğŸ‰ æ€»ç»“

**PM2 å°±æ˜¯ä¸€ä¸ªæœåŠ¡ç®¡ç†å·¥å…·**ï¼Œä¸»è¦ç”¨é€”ï¼š
1. âœ… è®©å‰ç«¯æœåŠ¡åœ¨åå°è¿è¡Œ
2. âœ… æ–¹ä¾¿æŸ¥çœ‹æ—¥å¿—å’ŒçŠ¶æ€
3. âœ… è‡ªåŠ¨é‡å¯å´©æºƒçš„æœåŠ¡
4. âœ… ç®¡ç†å¤šä¸ªæœåŠ¡

**ä½ åªéœ€è®°ä½**ï¼š
- `pm2 list` - çœ‹çŠ¶æ€
- `pm2 logs` - çœ‹æ—¥å¿—
- `pm2 restart` - é‡å¯

å°±è¿™ä¹ˆç®€å•ï¼ğŸš€
