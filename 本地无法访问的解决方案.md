# 🔧 本地无法访问的解决方案

## 🎯 问题诊断

**症状**：在你本地机器访问 `http://localhost:5173` 打不开  
**原因**：前端服务运行在**沙盒环境**中，不在你的本地机器上

---

## 📍 当前架构说明

```
┌──────────────────────────────────────────────────────────┐
│                   你的本地机器                            │
│  ┌─────────────────┐                                     │
│  │  Java后端       │ ← 运行在 localhost:8080             │
│  │  (Spring Boot)  │                                     │
│  └─────────────────┘                                     │
│                                                           │
│  你访问: http://localhost:5173 ← ❌ 这里没有前端服务      │
└──────────────────────────────────────────────────────────┘

┌──────────────────────────────────────────────────────────┐
│                   沙盒环境（远程）                         │
│  ┌─────────────────┐                                     │
│  │  Vue前端        │ ← 运行在沙盒的 0.0.0.0:5173         │
│  │  (Vite + PM2)   │                                     │
│  └─────────────────┘                                     │
│                                                           │
│  公网地址: https://5173-xxx.sandbox.novita.ai            │
└──────────────────────────────────────────────────────────┘
```

---

## ✅ 解决方案（2选1）

### 方案1：下载代码到本地运行（推荐）

#### 步骤1：确保你已下载代码
```bash
# 在你本地机器执行
cd /你存放代码的路径/webapp/frontend
ls -la
# 应该看到 src/, package.json 等文件
```

#### 步骤2：安装依赖（如果还没装）
```bash
cd /你存放代码的路径/webapp/frontend
npm install
```

#### 步骤3：启动前端
```bash
# 开发模式启动（推荐）
npm run dev
```

#### 步骤4：访问
启动后会显示：
```
VITE v7.3.0  ready in 500 ms

➜  Local:   http://localhost:5173/
➜  Network: http://192.168.x.x:5173/
```

现在在本地访问 `http://localhost:5173` 就可以了！

---

### 方案2：使用沙盒的公网地址

#### 直接访问沙盒前端
沙盒前端的公网地址（已启动）：
```
https://5173-i2wvcn4zqt161qrx2sfpj-5c13a017.sandbox.novita.ai
```

**但是**，这样访问会有问题：
- ❌ 前端调用 `http://localhost:8080`（你本地的后端）
- ❌ 沙盒无法访问你本地机器
- ❌ API请求会失败（CORS或连接超时）

#### 如果要用这个方案，需要修改API地址：
1. 把后端部署到公网（如Heroku、Railway等）
2. 修改 `frontend/src/api/index.js` 的 `BASE_URL` 为公网地址

**不推荐**：配置复杂，不适合开发调试

---

## 🚀 推荐的完整本地开发流程

### 环境准备
```bash
# 确认Node.js已安装
node -v  # 应该显示 v16+ 或更高

# 确认Java已安装
java -version  # 应该显示 Java 8+

# 确认MySQL已启动
mysql -u root -p
```

---

### 第1步：导入数据库（首次）
```sql
-- 登录MySQL
mysql -u root -p

-- 创建数据库
CREATE DATABASE IF NOT EXISTS deepdrama CHARACTER SET utf8mb4;
USE deepdrama;

-- 导入schema
SOURCE /你存放代码的路径/webapp/database/schema.sql;

-- 导入测试数据
SOURCE /你存放代码的路径/webapp/database/seed.sql;

-- 验证
SELECT COUNT(*) FROM scripts;  -- 应返回 30
```

---

### 第2步：启动后端
```bash
cd /你存放代码的路径/webapp/backend

# 检查数据库配置
cat src/main/resources/application.yml
# 确认 datasource.url、username、password 正确

# 启动后端
mvn spring-boot:run
```

**验证后端**：
```bash
curl http://localhost:8080/api/stats
# 应返回JSON数据
```

---

### 第3步：启动前端
```bash
# 打开新终端
cd /你存放代码的路径/webapp/frontend

# 首次需要安装依赖
npm install

# 启动前端
npm run dev
```

**启动成功后会显示**：
```
VITE v7.3.0  ready in 500 ms

➜  Local:   http://localhost:5173/
➜  Network: http://192.168.x.x:5173/
```

---

### 第4步：访问测试
1. 浏览器打开：`http://localhost:5173`
2. 按 `F12` 打开开发者工具
3. 查看 **Console** 标签，应该看到：
   ```
   App 组件已挂载，开始加载数据...
   正在加载统计数据...
   统计数据: {totalScripts: 30, ...}
   ```
4. 查看 **Network** 标签，应该看到：
   - `GET http://localhost:8080/api/stats` - 200 OK
   - `GET http://localhost:8080/api/scripts` - 200 OK

---

## ❌ 常见问题

### 问题1：npm install 报错
**错误**：`npm ERR! network`  
**解决**：
```bash
# 切换淘宝镜像
npm config set registry https://registry.npmmirror.com
npm install
```

---

### 问题2：npm run dev 端口被占用
**错误**：`Port 5173 is already in use`  
**解决**：
```bash
# Windows
netstat -ano | findstr :5173
taskkill /F /PID <PID>

# Linux/Mac
lsof -i :5173
kill -9 <PID>
```

或者修改端口：
```bash
# package.json 中修改 dev 脚本
"dev": "vite --port 5174"
```

---

### 问题3：前端启动成功但页面空白
**原因**：后端未启动  
**解决**：
1. 确认后端运行：`curl http://localhost:8080/api/stats`
2. 如果失败，启动后端：`mvn spring-boot:run`
3. 刷新前端页面（Ctrl+R）

---

### 问题4：Network Error / CORS错误
**症状**：Console显示 `Network Error` 或 CORS错误  
**解决**：
1. 确认后端启动：`curl http://localhost:8080/api/stats`
2. 检查 `frontend/src/api/index.js` 的 `BASE_URL` 是否为 `http://localhost:8080`
3. 确认后端有CORS配置（应该已配置）

---

## 📊 运行状态检查清单

### ✅ 后端检查
```bash
# 检查进程
jps | grep DeepDrama

# 测试API
curl http://localhost:8080/api/stats
curl http://localhost:8080/api/scripts

# 查看日志
# 在终端查看运行日志
```

### ✅ 前端检查
```bash
# 检查进程
ps aux | grep vite

# 测试访问
curl http://localhost:5173/

# 查看终端输出
# 应该显示 "ready in xxx ms"
```

### ✅ 浏览器检查
1. 打开 `http://localhost:5173`
2. F12 → Console → 有API调用日志
3. F12 → Network → 有HTTP请求记录
4. 页面显示真实数据

---

## 🎯 快速启动脚本

### Windows (start.bat)
```batch
@echo off
echo 启动DeepDrama项目...

echo [1/2] 启动后端...
start cmd /k "cd /d C:\你的路径\webapp\backend && mvn spring-boot:run"

timeout /t 10

echo [2/2] 启动前端...
start cmd /k "cd /d C:\你的路径\webapp\frontend && npm run dev"

echo 启动完成！
echo 后端: http://localhost:8080
echo 前端: http://localhost:5173
pause
```

### Linux/Mac (start.sh)
```bash
#!/bin/bash
echo "启动DeepDrama项目..."

# 启动后端
echo "[1/2] 启动后端..."
cd /你的路径/webapp/backend
mvn spring-boot:run &

# 等待10秒
sleep 10

# 启动前端
echo "[2/2] 启动前端..."
cd /你的路径/webapp/frontend
npm run dev &

echo "启动完成！"
echo "后端: http://localhost:8080"
echo "前端: http://localhost:5173"
```

---

## 💡 推荐工作流程

### 日常开发
1. 启动MySQL（一般系统自动启动）
2. 启动后端：`mvn spring-boot:run`（或IDE运行）
3. 启动前端：`npm run dev`
4. 访问：`http://localhost:5173`
5. 开发调试...
6. 停止服务：`Ctrl+C`

### 不需要PM2
本地开发**不需要PM2**，直接用 `npm run dev` 即可。  
PM2主要用于生产环境或远程服务器。

---

## 🔗 相关文档

- **前端启动指南**: `/home/user/webapp/前端启动指南.md`
- **后端指南**: `/home/user/webapp/JAVA_BACKEND_GUIDE.md`
- **测试指南**: `/home/user/webapp/立即测试指南.md`

---

## 📞 总结

**你的情况**：
- 前端在沙盒运行（远程）
- 后端在本地运行
- 无法通过 `localhost:5173` 访问

**解决方案**：
1. 在本地运行前端：`npm run dev`
2. 访问：`http://localhost:5173`
3. 前后端都在本地，完美联调！

现在就去本地启动吧！🚀
